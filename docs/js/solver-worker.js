(()=>{"use strict";var t={444:(t,e)=>{var o;Object.defineProperty(e,"__esModule",{value:!0}),e.Direction=void 0,(o=e.Direction||(e.Direction={})).UP="UP",o.LEFT="LEFT",o.RIGHT="RIGHT",o.DOWN="DOWN"},163:(t,e)=>{var o;Object.defineProperty(e,"__esModule",{value:!0}),e.SolverWorkerMessage=void 0,(o=e.SolverWorkerMessage||(e.SolverWorkerMessage={})).PING="PING",o.PONG="PONG",o.SOLVE="SOLVE",o.SOLVE_END="SOLVE_END",o.SOLVE_PROGRESS="SOLVE_PROGRESS"},695:(t,e)=>{var o;Object.defineProperty(e,"__esModule",{value:!0}),e.Wall=void 0,(o=e.Wall||(e.Wall={}))[o.UP=1]="UP",o[o.LEFT=2]="LEFT",o[o.RIGHT=4]="RIGHT",o[o.DOWN=8]="DOWN"},872:(t,e)=>{let o,s;function r(t,e){if(null==t)throw new Error("Invalid parameters, enter max, or max and min values");if(null==e&&(e=0),t<e)var o=t,s=e;else o=e,s=t;return o+Math.floor(a()*(s+1-o))}function i(t,e){if(null==t)throw new Error("Invalid parameters, enter max, or max and min values");if(null==e&&(e=0),t<e)var o=t,s=e;else o=e,s=t;return o+a()*(s-o)}Object.defineProperty(e,"__esModule",{value:!0}),e.getHash=e.shuffleCopy=e.shuffle=e.getSeed=e.setRandomSeed=e.setSeed=e.randomOne=e.randomItems=e.randomBool=e.randomFloats=e.randomFloat=e.randomInts=e.randomInt=void 0,h(),e.randomInt=r,e.randomInts=function(t,e,o){for(var s=[],i=0;i<t;i++)s.push(r(e,o));return s},e.randomFloat=i,e.randomFloats=function(t,e,o){for(var s=[],r=0;r<t;r++)s.push(i(e,o));return s},e.randomBool=function(t){return void 0===t&&(t=.5),a()<t},e.randomItems=function(t,e,o){if(o){for(var s=[],i=0;i<e;i++)s.push(t[r(0,t.length-1)]);return s}return(t=u(t)).slice(0,e)},e.randomOne=function(t){return t[r(0,t.length-1)]};var n,a=(n=Math.pow(2,32),function(){return s=(1664525*s+1013904223)%n,s/n});function l(t){o=t,s=t}function h(){l(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER))}function d(t){var e,o,s;for(s=t.length;s;s-=1)e=Math.floor(a()*s),o=t[s-1],t[s-1]=t[e],t[e]=o;return t}function u(t){return d(t.slice(0))}e.setSeed=l,e.setRandomSeed=h,e.getSeed=function(){return o},e.shuffle=d,e.shuffleCopy=u,e.getHash=function(t){var e,o,s=0;if(0===t.length)return s;for(e=0,o=t.length;e<o;e++)s=(s<<5)-s+t.charCodeAt(e),s|=0;return s}},164:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getTotals=e.getAndClear=e.pauseTimer=e.startTimer=void 0;const o={},s={};e.startTimer=function(t){s[t]=process?process.hrtime():(new Date).getTime()},e.pauseTimer=function(t){let e;if(process){const o=process.hrtime(s[t]);e=1e3*o[0]+o[1]/1e6}else{const o=s[t];e=(new Date).getTime()-o}o[t]=(o[t]||0)+e,t.startsWith("total-")||(o["total-"+t]=(o["total-"+t]||0)+e)},e.getAndClear=function(){const t={};return Object.entries(o).forEach((([e,s])=>{e.startsWith("total-")||(t[e]=s,o[e]=0)})),t},e.getTotals=function(){const t={};return Object.entries(o).forEach((([e,o])=>{e.startsWith("total-")&&(t[e]=o)})),t}},378:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Board=void 0;const s=o(872),r=o(695);e.Board=class{constructor(t,e){this.h=t,this.w=e,this.tiles=new Array(t).fill(null).map((()=>new Array(e).fill(0))),this.addTopWalls(),this.addBottomWalls(),this.addLeftWalls(),this.addRightWalls()}getTilesString(){return this.tiles.map((t=>t.map((t=>t.toString(16))).join(""))).join("")}setTiles(t){if(t.length!==this.w*this.h)throw Error(`Unable to set tiles. tiles.length was ${t.length}, expected ${this.w*this.h}`);const e=t.split("").map((t=>parseInt(t,16)));this.tiles=new Array(this.h).fill(null).map(((t,o)=>e.slice(o*this.w,o*this.w+this.w)))}addWall(t,e,o){if(t<0||t>=this.w)throw Error(`x must be between 0 and ${this.w-1}, was: ${t}`);if(e<0||e>=this.h)throw Error(`y must be between 0 and ${this.h-1}, was: ${e}`);this.addSingleWall(t,e,o);const s=this.getTileBehindTheWall(t,e,o);if(s){const t=this.getOppositeWall(o);this.addSingleWall(s.x,s.y,t)}}addRandomWalls(t){let e=0,o=0;for(;e<t&&o<1e3;){o++;const t=s.randomOne([r.Wall.UP,r.Wall.RIGHT,r.Wall.LEFT,r.Wall.DOWN]),i=s.randomInt(0,this.w-1),n=s.randomInt(0,this.h-1);this.tiles[n][i]&t||(this.addWall(i,n,t),e++)}}addSingleWall(t,e,o){const s=this.tiles[e][t];this.tiles[e][t]=s|o}getTileBehindTheWall(t,e,o){return o===r.Wall.UP&&e>0?{x:t,y:e-1}:o===r.Wall.LEFT&&t>0?{x:t-1,y:e}:o===r.Wall.RIGHT&&t+1<this.w?{x:t+1,y:e}:o===r.Wall.DOWN&&e+1<this.h?{x:t,y:e+1}:null}getOppositeWall(t){switch(t){case r.Wall.UP:return r.Wall.DOWN;case r.Wall.DOWN:return r.Wall.UP;case r.Wall.RIGHT:return r.Wall.LEFT;case r.Wall.LEFT:return r.Wall.RIGHT;default:throw Error("Invalid wall "+t)}}addTopWalls(){for(let t=0;t<this.w;t++)this.addSingleWall(t,0,r.Wall.UP)}addBottomWalls(){for(let t=0;t<this.w;t++)this.addSingleWall(t,this.h-1,r.Wall.DOWN)}addLeftWalls(){for(let t=0;t<this.h;t++)this.addSingleWall(0,t,r.Wall.LEFT)}addRightWalls(){for(let t=0;t<this.h;t++)this.addSingleWall(this.w-1,t,r.Wall.RIGHT)}}},81:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Goal=void 0,e.Goal=class{constructor(t,e,o){this.x=t,this.y=e,this.robotIdx=o}}},271:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Level=void 0;const s=o(378),r=o(369),i=o(81),n=o(872);e.Level=class{constructor(t){if("string"==typeof t){const e=t,[o,n,a,l,...h]=e.split("|"),d=parseInt(o),u=n.length/d,c=parseInt(a),f=parseInt(l);this.goal=new i.Goal(c%d,Math.floor(c/d),f),this.robots=h.map(Number).map(((t,e)=>new r.Robot(e,t%d,Math.floor(t/d)))),this.board=new s.Board(u,d),this.board.setTiles(n)}else{const{board:e,robots:o,goal:a}=function({width:t,height:e,wallsCount:o,seed:a,robotCount:l}){n.setSeed(a);const h=new s.Board(e,t);h.addRandomWalls(o);const d=[];for(let t=0;t<h.w;t++)for(let e=0;e<h.h;e++)d.push({x:t,y:e});const u=n.shuffle(d),c=new Array(l).fill(null).map(((t,e)=>{const o=u.pop();return new r.Robot(e,o.x,o.y)})),f=u.pop(),g=n.randomOne(c).idx;return{goal:new i.Goal(f.x,f.y,g),robots:c,board:h}}(t);this.board=e,this.robots=o,this.goal=a}}pos2num(t){return t.x+t.y*this.board.w}getLevelString(){const t=this.pos2num(this.goal),e=this.board.getTilesString(),o=this.robots.map((t=>this.pos2num(t))).join("|");return`${this.board.w}|${e}|${t}|${this.goal.robotIdx}|${o}`}}},369:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.cloneRobots=e.Robot=void 0;class o{constructor(t,e,o){this.idx=t,this.x=e,this.y=o}getPos(){return{x:this.x,y:this.y}}setPos(t){this.x=t.x,this.y=t.y}clone(){return new o(this.idx,this.x,this.y)}}e.Robot=o,e.cloneRobots=function(t){return t.map((t=>t.clone()))}},613:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Solver=void 0;const s=o(509),r=o(164);e.Solver=class{constructor(t,e={}){this.currentStateIndex=0,this.statesQueue=[],this.states=new Map,this.routeFound=!1,this.aborted=!1,this.allStatesChecked=!1,this.running=!1,this.progressRatio=1e3,this.duration=0,this.pos2num=t=>t.x+t.y*this.board.w,this.getStateHash=(t,e)=>{const o=this.goal.robotIdx,s=t.filter((t=>t.idx!==o)).map((t=>t.posNum)).sort().join("|");return t[o].posNum+(e?"Y":"N")+s};const{backAgain:o=!1,abortAfter:s=1e7}=e;this.board=t.board,this.robots=t.robots.map((t=>({...t,posNum:t.x+t.y*this.board.w}))),this.goal=t.goal,this.goalTile=this.pos2num(this.goal),this.primaryHomeTile=this.pos2num(this.robots[this.goal.robotIdx]),this.backAgain=o,this.abortAfter=s}solve(){const t=this.getStateHash(this.robots,!1);this.statesQueue.push(t),this.states.set(t,{moves:0,hash:t,robots:this.robots.slice(),goalVisited:!1,direction:null,robotIdx:null});const e=new Date;for(this.running=!0;this.running;)this.checkNext();this.duration=((new Date).getTime()-e.getTime())/1e3;const o=this.getResult();return this.completeCallback&&this.completeCallback(o),this.statesQueue.length=0,this.states.clear(),o}isRouteFound(){return this.routeFound}getResult(){return{duration:this.duration,statesChecked:this.currentStateIndex,isRouteFound:this.routeFound,isAllStatesChecked:this.allStatesChecked,isAborted:this.aborted,route:this.foundRoute,robotsUsed:this.robotsUsed,minMoves:this.minMoves,timers:r.getTotals()}}onComplete(t){this.completeCallback=t}onProgress(t,e=1e3){this.progressRatio=e,this.progressCallback=t}checkNext(){if(this.currentStateIndex+1>this.statesQueue.length)return this.allStatesChecked=!0,void(this.running=!1);const t=this.statesQueue[this.currentStateIndex],e=this.states.get(t);if(this.currentStateIndex===this.abortAfter)return this.minMoves=e.moves,this.aborted=!0,void(this.running=!1);this.progressCallback&&this.currentStateIndex%this.progressRatio==0&&this.progressCallback({checkedStates:this.currentStateIndex,currentMovesCount:e.moves,timers:r.getAndClear()}),this.processState(e),this.currentStateIndex++}checkIfShortestRouteFound(t){if(t.robotIdx!==this.goal.robotIdx)return;const e=t.robots[this.goal.robotIdx];this.isAtGoal(e)?(t.goalVisited=!0,this.backAgain||this.shortestRouteFound(t)):this.backAgain&&t.goalVisited&&this.isAtHome(e)&&this.shortestRouteFound(t)}isAtGoal(t){return t.posNum===this.goalTile}isAtHome(t){return t.posNum===this.primaryHomeTile}shortestRouteFound(t){this.routeFound=!0,this.running=!1;let e=t;this.foundRoute=[];const o=new Set;for(;e.previous;){this.foundRoute.unshift({robotIdx:e.robotIdx,direction:e.direction}),o.add(e.robotIdx);const t=this.states.get(e.previous);if(void 0===t)throw Error(`state ${e.previous} not found`);e=t}this.robotsUsed=[...o].sort()}processState(t){const e=[];for(const o of t.robots){const r=t.robots.filter((t=>t.idx!==o.idx)),i=(0,s.goUp)(this.board,o,r);i&&e.push(i);const n=(0,s.goLeft)(this.board,o,r);n&&e.push(n);const a=(0,s.goRight)(this.board,o,r);a&&e.push(a);const l=(0,s.goDown)(this.board,o,r);l&&e.push(l)}for(let o of e){const e=t.robots.slice();e[o.robotIdx]={x:o.pos.x,y:o.pos.y,idx:o.robotIdx,posNum:this.pos2num(o.pos)};const s=this.getStateHash(e,t.goalVisited);if(this.states.has(s))continue;const r={hash:s,previous:t.hash,robots:e,goalVisited:t.goalVisited,moves:t.moves+1,direction:o.dir,robotIdx:o.robotIdx};this.checkIfShortestRouteFound(r),this.statesQueue.push(r.hash),this.states.set(r.hash,r)}t.robots.length=0,t.robots=void 0,t.hash=void 0,t.goalVisited=void 0,t.moves=void 0}}},509:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.hasWall=e.goRight=e.goLeft=e.goDown=e.goUp=void 0;const s=o(444),r=o(695);function i(t,e,o){return 0!=(t.tiles[e.y][e.x]&o)}e.goUp=function(t,e,o){const n={x:e.x,y:e.y};if(i(t,n,r.Wall.UP))return null;const a=Math.max(...o.filter((t=>t.x===n.x&&t.y<n.y)).map((t=>t.y)));for(;n.y>0&&n.y-1!==a&&!i(t,n,r.Wall.UP);n.y--);return n.y===e.y?null:{pos:n,robotIdx:e.idx,dir:s.Direction.UP}},e.goDown=function(t,e,o){const n={x:e.x,y:e.y};if(i(t,n,r.Wall.DOWN))return null;const a=Math.min(...o.filter((t=>t.x===n.x&&t.y>n.y)).map((t=>t.y)));for(;n.y<t.h&&n.y+1!==a&&!i(t,n,r.Wall.DOWN);n.y++);return n.y===e.y?null:{pos:n,robotIdx:e.idx,dir:s.Direction.DOWN}},e.goLeft=function(t,e,o){const n={x:e.x,y:e.y};if(i(t,n,r.Wall.LEFT))return null;const a=Math.max(...o.filter((t=>t.y===n.y&&t.x<n.x)).map((t=>t.x)));for(;n.x>0&&n.x-1!==a&&!i(t,n,r.Wall.LEFT);n.x--);return n.x===e.x?null:{pos:n,robotIdx:e.idx,dir:s.Direction.LEFT}},e.goRight=function(t,e,o){const n={x:e.x,y:e.y};if(i(t,n,r.Wall.RIGHT))return null;const a=Math.min(...o.filter((t=>t.y===n.y&&t.x>n.x)).map((t=>t.x)));for(;n.x<t.w&&n.x+1!==a&&!i(t,n,r.Wall.RIGHT);n.x++);return n.x===e.x?null:{pos:n,robotIdx:e.idx,dir:s.Direction.RIGHT}},e.hasWall=i}},e={};function o(s){var r=e[s];if(void 0!==r)return r.exports;var i=e[s]={exports:{}};return t[s](i,i.exports,o),i.exports}(()=>{const t=o(613),e=o(163),s=o(271);function r(t){postMessage({type:e.SolverWorkerMessage.SOLVE_END,result:t}),close()}function i(t){postMessage({type:e.SolverWorkerMessage.SOLVE_PROGRESS,progress:t})}self.onmessage=function(o){switch(o.data.type){case e.SolverWorkerMessage.SOLVE:{const e=new s.Level(o.data.levelString),n=new t.Solver(e,{backAgain:o.data.backAgain});n.onComplete(r),n.onProgress(i),n.solve();break}default:throw Error("Worker recieved an unknown message"+o.data.type)}}})()})();